<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Image segmentation based on Superpixels and Clustering • OpenImageR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Image segmentation based on Superpixels and Clustering">
<meta property="og:description" content="OpenImageR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">OpenImageR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">1.2.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/Gabor_Feature_Extraction.html">Gabor Feature extraction</a>
    </li>
    <li>
      <a href="../articles/Image_segmentation_superpixels_clustering.html">Image segmentation based on Superpixels and Clustering</a>
    </li>
    <li>
      <a href="../articles/The_OpenImageR_package.html">Functionality of the OpenImageR package</a>
    </li>
    <li>
      <a href="../articles/Warp_Affine.html">Warp Affine using R</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/mlampros/OpenImageR/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="Image_segmentation_superpixels_clustering_files/accessible-code-block-0.0.1/empty-anchor.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Image segmentation based on Superpixels and Clustering</h1>
                        <h4 data-toc-skip class="author">Lampros Mouselimis</h4>
            
            <h4 data-toc-skip class="date">2022-08-14</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/mlampros/OpenImageR/blob/HEAD/vignettes/Image_segmentation_superpixels_clustering.Rmd" class="external-link"><code>vignettes/Image_segmentation_superpixels_clustering.Rmd</code></a></small>
      <div class="hidden name"><code>Image_segmentation_superpixels_clustering.Rmd</code></div>

    </div>

    
    
<p>In this vignette, I’ll explain the new functionality of the OpenImageR package, <a href="https://www.epfl.ch/labs/ivrl/research/slic-superpixels/" class="external-link">SLIC and SLICO superpixels</a> (Simple Linear Iterative Clustering) and their applicability based on <a href="https://www.ijsr.net/archive/v4i4/SUB152869.pdf" class="external-link">an IJSR article</a>. The author of the article uses superpixel (SLIC) and Clustering (Affinity Propagation) to perform image segmentation (the article was reproduced using the latest versions of the <a href="https://github.com/mlampros/OpenImageR" class="external-link">OpenImageR</a> and <a href="https://github.com/mlampros/ClusterR" class="external-link">ClusterR</a> packages).</p>
<p><br></p>
<div class="section level3">
<h3 id="superpixels">Superpixels<a class="anchor" aria-label="anchor" href="#superpixels"></a>
</h3>
<p>“Introduced by Ren and Malik in 2003, superpixels group pixels similar in color and other low-level properties. In this respect, superpixels address two problems inherent to the processing of digital images: firstly, pixels are merely a result of discretization; and secondly, the high number of pixels in large images prevents many algorithms from being computationally feasible. Ren and Malik introduce superpixels as more natural entities - grouping pixels which perceptually belong together while heavily reducing the number of primitives for subsequent algorithms.” You can read more about superpixels in <a href="https://arxiv.org/pdf/1612.01601.pdf" class="external-link">this arxiv article</a>.</p>
<p><br></p>
<p>The <em>superpixels()</em> function of the <em>OpenImageR</em> package is based on the open source C++ code of the <a href="https://www.epfl.ch/labs/ivrl/research/slic-superpixels/" class="external-link">IMAGE AND VISUAL REPRESENTATION LAB IVRL</a> and allows users to receive <em>labels</em> and <em>output slic images</em>. The following code chunk illustrates how this can be done using either the “slic” or the “slico” method,</p>
<p><br></p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a></span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(OpenImageR)</span>
<span id="cb1-3"><a href="#cb1-3"></a></span>
<span id="cb1-4"><a href="#cb1-4"></a>path =<span class="st"> </span><span class="kw">system.file</span>(<span class="st">"tmp_images"</span>, <span class="st">"slic_im.png"</span>, <span class="dt">package =</span> <span class="st">"OpenImageR"</span>)</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a>im =<span class="st"> </span><span class="kw">readImage</span>(path)</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co">#--------------</span></span>
<span id="cb1-10"><a href="#cb1-10"></a><span class="co"># "slic" method</span></span>
<span id="cb1-11"><a href="#cb1-11"></a><span class="co">#--------------</span></span>
<span id="cb1-12"><a href="#cb1-12"></a></span>
<span id="cb1-13"><a href="#cb1-13"></a>res_slic =<span class="st"> </span><span class="kw">superpixels</span>(<span class="dt">input_image =</span> im,</span>
<span id="cb1-14"><a href="#cb1-14"></a>                       <span class="dt">method =</span> <span class="st">"slic"</span>,</span>
<span id="cb1-15"><a href="#cb1-15"></a>                       <span class="dt">superpixel =</span> <span class="dv">200</span>, </span>
<span id="cb1-16"><a href="#cb1-16"></a>                       <span class="dt">compactness =</span> <span class="dv">20</span>,</span>
<span id="cb1-17"><a href="#cb1-17"></a>                       <span class="dt">return_slic_data =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1-18"><a href="#cb1-18"></a>                       <span class="dt">return_labels =</span> <span class="ot">TRUE</span>, </span>
<span id="cb1-19"><a href="#cb1-19"></a>                       <span class="dt">write_slic =</span> <span class="st">""</span>, </span>
<span id="cb1-20"><a href="#cb1-20"></a>                       <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-21"><a href="#cb1-21"></a></span>
<span id="cb1-22"><a href="#cb1-22"></a><span class="kw">str</span>(res_slic)</span>
<span id="cb1-23"><a href="#cb1-23"></a></span>
<span id="cb1-24"><a href="#cb1-24"></a>List of <span class="dv">2</span></span>
<span id="cb1-25"><a href="#cb1-25"></a> <span class="op">$</span><span class="st"> </span>slic_data<span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">360</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">360</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> ...</span>
<span id="cb1-26"><a href="#cb1-26"></a> <span class="op">$</span><span class="st"> </span>labels   <span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">360</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">360</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb1-27"><a href="#cb1-27"></a> </span>
<span id="cb1-28"><a href="#cb1-28"></a> </span>
<span id="cb1-29"><a href="#cb1-29"></a> </span>
<span id="cb1-30"><a href="#cb1-30"></a><span class="co">#---------------</span></span>
<span id="cb1-31"><a href="#cb1-31"></a><span class="co"># "slico" method       [ the "slico" method does not require the "compactness" parameter ]</span></span>
<span id="cb1-32"><a href="#cb1-32"></a><span class="co">#---------------</span></span>
<span id="cb1-33"><a href="#cb1-33"></a></span>
<span id="cb1-34"><a href="#cb1-34"></a>res_slico =<span class="st"> </span><span class="kw">superpixels</span>(<span class="dt">input_image =</span> im,</span>
<span id="cb1-35"><a href="#cb1-35"></a>                        <span class="dt">method =</span> <span class="st">"slico"</span>,</span>
<span id="cb1-36"><a href="#cb1-36"></a>                        <span class="dt">superpixel =</span> <span class="dv">200</span>, </span>
<span id="cb1-37"><a href="#cb1-37"></a>                        <span class="dt">return_slic_data =</span> <span class="ot">TRUE</span>,</span>
<span id="cb1-38"><a href="#cb1-38"></a>                        <span class="dt">return_labels =</span> <span class="ot">TRUE</span>, </span>
<span id="cb1-39"><a href="#cb1-39"></a>                        <span class="dt">write_slic =</span> <span class="st">""</span>, </span>
<span id="cb1-40"><a href="#cb1-40"></a>                        <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb1-41"><a href="#cb1-41"></a></span>
<span id="cb1-42"><a href="#cb1-42"></a><span class="kw">str</span>(res_slico)</span>
<span id="cb1-43"><a href="#cb1-43"></a></span>
<span id="cb1-44"><a href="#cb1-44"></a>List of <span class="dv">2</span></span>
<span id="cb1-45"><a href="#cb1-45"></a> <span class="op">$</span><span class="st"> </span>slic_data<span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">360</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">360</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> <span class="dv">255</span> ...</span>
<span id="cb1-46"><a href="#cb1-46"></a> <span class="op">$</span><span class="st"> </span>labels   <span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">360</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">360</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span></code></pre></div>
<p><br></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#-----------------------------</span></span>
<span><span class="co"># plot both "slic" and "slico"</span></span>
<span><span class="co">#-----------------------------</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>,<span class="fl">2</span><span class="op">)</span>, mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_slic</span> <span class="op">=</span> <span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/NormalizeObject.html">NormalizeObject</a></span><span class="op">(</span><span class="va">res_slic</span><span class="op">$</span><span class="va">slic_data</span><span class="op">)</span></span>
<span><span class="va">plot_slic</span> <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">as.raster</a></span><span class="op">(</span><span class="va">plot_slic</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plot_slic</span><span class="op">)</span></span>
<span></span>
<span><span class="va">plot_slico</span> <span class="op">=</span> <span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/NormalizeObject.html">NormalizeObject</a></span><span class="op">(</span><span class="va">res_slico</span><span class="op">$</span><span class="va">slic_data</span><span class="op">)</span></span>
<span><span class="va">plot_slico</span> <span class="op">=</span> <span class="fu">grDevices</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/grDevices/as.raster.html" class="external-link">as.raster</a></span><span class="op">(</span><span class="va">plot_slico</span><span class="op">)</span></span>
<span><span class="fu">graphics</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">plot_slico</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/slic_vs_slico.png"></p>
<p><br></p>
<p>According to the <a href="https://www.epfl.ch/labs/ivrl/research/slic-superpixels/" class="external-link">authors of the slic method</a>, “<em>SLIC uses the same compactness parameter (chosen by user) for all superpixels in the image. If the image is smooth in certain regions but highly textured in others, SLIC produces smooth regular-sized superpixels in the smooth regions and highly irregular superpixels in the textured regions. So, it becomes tricky choosing the right parameter for each image. SLICO does away with this problem completely. The user no longer has to set the compactness parameter or try different values of it. SLICO adaptively chooses the compactness parameter for each superpixel differently. This generates regular shaped superpixels in both textured and non textured regions alike. The improvement comes with hardly any compromise on the computational efficiency – SLICO continues to be as fast as SLIC</em>.”</p>
<p><br></p>
<p>More information about the parameters of the <em>superpixels()</em> function can be found in the package documentation.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="image-segmentation">Image segmentation<a class="anchor" aria-label="anchor" href="#image-segmentation"></a>
</h3>
<p>“In computer vision, image segmentation is the process of partitioning a digital image into multiple segments (sets of pixels, also known as super-pixels). The goal of segmentation is to simplify and/or change the representation of an image into something that is more meaningful and easier to analyze. Image segmentation is typically used to locate objects and boundaries (lines, curves, etc.) in images. More precisely, image segmentation is the process of assigning a label to every pixel in an image such that pixels with the same label share certain characteristics.” You can read more about image segmentation in this <a href="https://en.wikipedia.org/wiki/Image_segmentation" class="external-link">wikipedia article</a>.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="affinity-propagation">Affinity Propagation<a class="anchor" aria-label="anchor" href="#affinity-propagation"></a>
</h3>
<p>“Affinity propagation is a new algorithm that takes as input measures of similarity between pairs of data points and simultaneously considers all data points as potential exemplars. Real-valued messages are exchanged between data points until a high-quality set of exemplars and corresponding clusters gradually emerges. We have used affinity propagation to solve a variety of clustering problems and we found that it uniformly found clusters with much lower error than those found by other methods, and it did so in less than one-hundredth the amount of time. Because of its simplicity, general applicability, and performance, we believe affinity propagation will prove to be of broad value in science and engineering.” The Affinity Propagation algorithm is explained in detail in the <em>“authors web page”</em> ( www.psi.toronto.edu/index.php?q=affinity%20propagation ).</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="image-segmentation-based-on-superpixels-slic-slico-and-affinity-propagation-ap">Image segmentation based on superpixels (SLIC, SLICO) and Affinity Propagation (AP)<a class="anchor" aria-label="anchor" href="#image-segmentation-based-on-superpixels-slic-slico-and-affinity-propagation-ap"></a>
</h3>
<p>The <a href="https://www.ijsr.net/archive/v4i4/SUB152869.pdf" class="external-link">author of the article</a>, that I mentioned earlier, uses a method named <strong>SLICAP</strong> (SLIC + AP) to perform image segmentation. The methodology is the following:</p>
<ul>
<li>First, the SLICAP technique uses the SLIC superpixel algorithm to form an over-segmentation of an image</li>
<li>Then, a similarity is constructed based on the features of superpixels</li>
<li>Finally, the AP algorithm clusters these superpixels with the similarities obtained</li>
</ul>
<p><br></p>
<p>The advantages of this method compared to other methods are the following:</p>
<ul>
<li>similarities are not computed based on all data (image), but on the resulted superpixels (reduction of the computational burden)</li>
<li>the user does not have to specify the number of clusters (AP algorithm) as is the case with other clustering methods such as Kmeans</li>
</ul>
<p><br></p>
<p>The author of the article utilizes,</p>
<ul>
<li>the <a href="https://en.wikipedia.org/wiki/CIELAB_color_space" class="external-link">CIELAB colour space</a> which is designed to be perceptually uniform with respect to human color vision</li>
<li>the <em>negative Euclidean distance</em> (although the author uses 3 different similarity measures (page 1526), I’ll use the first one in my code because it gives better results)</li>
<li>
<em>weights for the 3 colour channels</em> (wL, wA, wB) because they keep balance so as to be consistent with human perception</li>
<li>a <em>colorradius</em> to adjust the number of clusters. If its value is low, the number of targets would increase, which leads to more detailed segmentation results</li>
<li>the <a href="https://www2.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/resources.html" class="external-link">Berkeley Segmentation Database (BSD)</a> (it can be downloaded also from my <a href="https://github.com/mlampros/DataSets" class="external-link">Github repository</a>)</li>
</ul>
<p><br></p>
<p>I bundled the code in an R package, <a href="https://github.com/mlampros/SuperpixelImageSegmentation" class="external-link">SuperpixelImageSegmentation</a>, which can be downloaded from Github (consult the README.md file of the package for more information). The following code snippet first reads the input image and then performs image segmentation based on SLIC superpixels and AP clustering,</p>
<p><br></p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/mlampros/SuperpixelImageSegmentation" class="external-link">SuperpixelImageSegmentation</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">path</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"BSR_bsds500_image.jpg"</span>, package <span class="op">=</span> <span class="st">"SuperpixelImageSegmentation"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">im</span> <span class="op">=</span> <span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/readImage.html">readImage</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/BSR_bsds500_image.jpg"></p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a></span>
<span id="cb4-2"><a href="#cb4-2"></a>init =<span class="st"> </span>Image_Segmentation<span class="op">$</span><span class="kw">new</span>()</span>
<span id="cb4-3"><a href="#cb4-3"></a></span>
<span id="cb4-4"><a href="#cb4-4"></a>spx =<span class="st"> </span>init<span class="op">$</span><span class="kw">spixel_segmentation</span>(<span class="dt">input_image =</span> im, </span>
<span id="cb4-5"><a href="#cb4-5"></a>                               <span class="dt">superpixel =</span> <span class="dv">600</span>, </span>
<span id="cb4-6"><a href="#cb4-6"></a>                               <span class="dt">AP_data =</span> <span class="ot">TRUE</span>,</span>
<span id="cb4-7"><a href="#cb4-7"></a>                               <span class="dt">use_median =</span> <span class="ot">TRUE</span>, </span>
<span id="cb4-8"><a href="#cb4-8"></a>                               <span class="dt">sim_wL =</span> <span class="dv">3</span>, </span>
<span id="cb4-9"><a href="#cb4-9"></a>                               <span class="dt">sim_wA =</span> <span class="dv">10</span>, </span>
<span id="cb4-10"><a href="#cb4-10"></a>                               <span class="dt">sim_wB =</span> <span class="dv">10</span>,</span>
<span id="cb4-11"><a href="#cb4-11"></a>                               <span class="dt">sim_color_radius =</span> <span class="dv">10</span>, </span>
<span id="cb4-12"><a href="#cb4-12"></a>                               <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb4-13"><a href="#cb4-13"></a>                               </span>
<span id="cb4-14"><a href="#cb4-14"></a>                               </span>
<span id="cb4-15"><a href="#cb4-15"></a>Sequential computation starts ...</span>
<span id="cb4-16"><a href="#cb4-16"></a>WARNING<span class="op">:</span><span class="st"> </span>The input data has values between <span class="fl">0.000000</span> and <span class="dv">1</span>.<span class="fl">000000.</span> The image<span class="op">-</span>data will be multiplied by the value<span class="op">:</span><span class="st"> </span><span class="dv">255</span><span class="op">!</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>The super<span class="op">-</span>pixel slic method as pre<span class="op">-</span>processing step was used <span class="op">/</span><span class="st"> </span>completed<span class="op">!</span></span>
<span id="cb4-18"><a href="#cb4-18"></a>The similarity matrix based on super<span class="op">-</span>pixels was computed<span class="op">!</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>It took <span class="dv">179</span> iterations <span class="cf">for</span> affinity propagation to complete<span class="op">!</span></span>
<span id="cb4-20"><a href="#cb4-20"></a><span class="dv">6</span> clusters were chosen based on super<span class="op">-</span>pixels and affinity propagation<span class="op">!</span></span>
<span id="cb4-21"><a href="#cb4-21"></a>Image data based on Affinity Propagation <span class="kw">clustering</span> (<span class="st">'AP_image_data'</span>) will be returned<span class="op">!</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>Elapsed time<span class="op">:</span><span class="st"> </span><span class="dv">0</span> hours and <span class="dv">0</span> minutes and <span class="dv">2</span> seconds. </span>
<span id="cb4-23"><a href="#cb4-23"></a></span></code></pre></div>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a><span class="kw">str</span>(spx)</span>
<span id="cb5-2"><a href="#cb5-2"></a></span>
<span id="cb5-3"><a href="#cb5-3"></a>List of <span class="dv">4</span></span>
<span id="cb5-4"><a href="#cb5-4"></a> <span class="op">$</span><span class="st"> </span>KMeans_image_data<span class="op">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb5-5"><a href="#cb5-5"></a> <span class="op">$</span><span class="st"> </span>masks            <span class="op">:</span><span class="st"> </span><span class="kw">list</span>()</span>
<span id="cb5-6"><a href="#cb5-6"></a>  ..<span class="op">-</span><span class="st"> </span><span class="kw">attr</span>(<span class="op">*</span>, <span class="st">"dim"</span>)=<span class="st"> </span>int [<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] <span class="dv">0</span> <span class="dv">0</span></span>
<span id="cb5-7"><a href="#cb5-7"></a> <span class="op">$</span><span class="st"> </span>centr            <span class="op">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb5-8"><a href="#cb5-8"></a> <span class="op">$</span><span class="st"> </span>AP_image_data    <span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> <span class="dv">1</span> ...</span>
<span id="cb5-9"><a href="#cb5-9"></a></span></code></pre></div>
<p><br></p>
<p>By using a <em>colorradius</em> of 10 (the author uses by default 20) I receive the following output,</p>
<p><br></p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/imageShow.html">imageShow</a></span><span class="op">(</span><span class="va">spx</span><span class="op">$</span><span class="va">AP_image_data</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/BSR_bsds500_segmentation.png"></p>
<p><br></p>
<p>Decreasing the number of superpixels (from 600 to 200) or modifying the colorradius (from 10 to 20) will affect the quality of the output image, but it will also reduce the computation time.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="superpixels-ap-and-kmeans-or-mini-batch-kmeans">Superpixels, AP and Kmeans (or Mini-Batch-Kmeans)<a class="anchor" aria-label="anchor" href="#superpixels-ap-and-kmeans-or-mini-batch-kmeans"></a>
</h3>
<p>As a follow-up to the author’s method, one might take advantage of the automatic way the AP algorithm determines the number of clusters in order to perform vector quantization using kmeans (this will give qualitative better results at the cost of increasing computation time). I included additional parameters in the <em>spixel_segmentation()</em> method of the <em>Image_Segmentation</em> R6-class for this purpose and I’ll use the following image, which appears also in the article,</p>
<p><br></p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">path_km</span> <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/system.file.html" class="external-link">system.file</a></span><span class="op">(</span><span class="st">"images"</span>, <span class="st">"airplane.jpg"</span>, package <span class="op">=</span> <span class="st">"SuperpixelImageSegmentation"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">im_km</span> <span class="op">=</span> <span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/readImage.html">readImage</a></span><span class="op">(</span><span class="va">path_km</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/imageShow.html">imageShow</a></span><span class="op">(</span><span class="va">im_km</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/airplane.jpg"></p>
<p><br></p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a></span>
<span id="cb8-2"><a href="#cb8-2"></a>spx_km =<span class="st"> </span>init<span class="op">$</span><span class="kw">spixel_segmentation</span>(<span class="dt">input_image =</span> im_km, </span>
<span id="cb8-3"><a href="#cb8-3"></a>                                  <span class="dt">superpixel =</span> <span class="dv">600</span>, </span>
<span id="cb8-4"><a href="#cb8-4"></a>                                  <span class="dt">AP_data =</span> <span class="ot">TRUE</span>,</span>
<span id="cb8-5"><a href="#cb8-5"></a>                                  <span class="dt">use_median =</span> <span class="ot">TRUE</span>, </span>
<span id="cb8-6"><a href="#cb8-6"></a>                                  <span class="dt">sim_wL =</span> <span class="dv">3</span>, </span>
<span id="cb8-7"><a href="#cb8-7"></a>                                  <span class="dt">sim_wA =</span> <span class="dv">10</span>, </span>
<span id="cb8-8"><a href="#cb8-8"></a>                                  <span class="dt">sim_wB =</span> <span class="dv">10</span>,</span>
<span id="cb8-9"><a href="#cb8-9"></a>                                  <span class="dt">sim_color_radius =</span> <span class="dv">10</span>, </span>
<span id="cb8-10"><a href="#cb8-10"></a>                                  <span class="dt">kmeans_method =</span> <span class="st">"kmeans"</span>,</span>
<span id="cb8-11"><a href="#cb8-11"></a>                                  <span class="dt">kmeans_initializer =</span> <span class="st">"kmeans++"</span>,</span>
<span id="cb8-12"><a href="#cb8-12"></a>                                  <span class="dt">kmeans_num_init =</span> <span class="dv">3</span>, </span>
<span id="cb8-13"><a href="#cb8-13"></a>                                  <span class="dt">kmeans_max_iters =</span> <span class="dv">100</span>,</span>
<span id="cb8-14"><a href="#cb8-14"></a>                                  <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb8-15"><a href="#cb8-15"></a></span>
<span id="cb8-16"><a href="#cb8-16"></a></span>
<span id="cb8-17"><a href="#cb8-17"></a>Sequential computation starts ...</span>
<span id="cb8-18"><a href="#cb8-18"></a>WARNING<span class="op">:</span><span class="st"> </span>The input data has values between <span class="fl">0.000000</span> and <span class="dv">1</span>.<span class="fl">000000.</span> The image<span class="op">-</span>data will be multiplied by the value<span class="op">:</span><span class="st"> </span><span class="dv">255</span><span class="op">!</span></span>
<span id="cb8-19"><a href="#cb8-19"></a>The super<span class="op">-</span>pixel slic method as pre<span class="op">-</span>processing step was used <span class="op">/</span><span class="st"> </span>completed<span class="op">!</span></span>
<span id="cb8-20"><a href="#cb8-20"></a>The similarity matrix based on super<span class="op">-</span>pixels was computed<span class="op">!</span></span>
<span id="cb8-21"><a href="#cb8-21"></a>It took <span class="dv">146</span> iterations <span class="cf">for</span> affinity propagation to complete<span class="op">!</span></span>
<span id="cb8-22"><a href="#cb8-22"></a><span class="dv">10</span> clusters were chosen based on super<span class="op">-</span>pixels and affinity propagation<span class="op">!</span></span>
<span id="cb8-23"><a href="#cb8-23"></a>Image data based on Affinity Propagation <span class="kw">clustering</span> (<span class="st">'AP_image_data'</span>) will be returned<span class="op">!</span></span>
<span id="cb8-24"><a href="#cb8-24"></a>The kmeans algorithm based on the number of affinity<span class="op">-</span>propagation<span class="op">-</span>clusters was completed<span class="op">!</span></span>
<span id="cb8-25"><a href="#cb8-25"></a>Pre<span class="op">-</span>processing of the kmeans<span class="op">-</span>output<span class="op">-</span>image is completed<span class="op">!</span></span>
<span id="cb8-26"><a href="#cb8-26"></a>Elapsed time<span class="op">:</span><span class="st"> </span><span class="dv">0</span> hours and <span class="dv">0</span> minutes and <span class="dv">8</span> seconds. </span>
<span id="cb8-27"><a href="#cb8-27"></a></span>
<span id="cb8-28"><a href="#cb8-28"></a></span>
<span id="cb8-29"><a href="#cb8-29"></a><span class="kw">str</span>(spx_km)</span>
<span id="cb8-30"><a href="#cb8-30"></a></span>
<span id="cb8-31"><a href="#cb8-31"></a>List of <span class="dv">4</span></span>
<span id="cb8-32"><a href="#cb8-32"></a> <span class="op">$</span><span class="st"> </span>KMeans_image_data<span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="fl">0.1</span> <span class="fl">0.1</span> <span class="fl">0.26</span> <span class="fl">0.389</span> <span class="fl">0.432</span> ...</span>
<span id="cb8-33"><a href="#cb8-33"></a> <span class="op">$</span><span class="st"> </span>masks            <span class="op">:</span>List of <span class="dv">10</span></span>
<span id="cb8-34"><a href="#cb8-34"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-35"><a href="#cb8-35"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-36"><a href="#cb8-36"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-37"><a href="#cb8-37"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-38"><a href="#cb8-38"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-39"><a href="#cb8-39"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-40"><a href="#cb8-40"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-41"><a href="#cb8-41"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-42"><a href="#cb8-42"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-43"><a href="#cb8-43"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num[<span class="dv">0</span> , <span class="dv">0</span> , <span class="dv">0</span> ] </span>
<span id="cb8-44"><a href="#cb8-44"></a>  ..<span class="op">-</span><span class="st"> </span><span class="kw">attr</span>(<span class="op">*</span>, <span class="st">"dim"</span>)=<span class="st"> </span>int [<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] <span class="dv">10</span> <span class="dv">1</span></span>
<span id="cb8-45"><a href="#cb8-45"></a> <span class="op">$</span><span class="st"> </span>centr            <span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="fl">0.432</span> <span class="fl">0.251</span> <span class="fl">0.863</span> <span class="fl">0.552</span> <span class="fl">0.26</span> ...</span>
<span id="cb8-46"><a href="#cb8-46"></a> <span class="op">$</span><span class="st"> </span>AP_image_data    <span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="fl">0.404</span> <span class="fl">0.404</span> <span class="fl">0.404</span> <span class="fl">0.404</span> <span class="fl">0.404</span> ...</span></code></pre></div>
<p><br></p>
<p>The following image shows the output based on <em>Superpixels + AP</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/imageShow.html">imageShow</a></span><span class="op">(</span><span class="va">spx_km</span><span class="op">$</span><span class="va">AP_image_data</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/segment_AP.png"></p>
<p><br></p>
<p>and the following based on <em>Superpixels + AP + Kmeans (vector quantization)</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/imageShow.html">imageShow</a></span><span class="op">(</span><span class="va">spx_km</span><span class="op">$</span><span class="va">KMeans_image_data</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/segment_kmeans.png"></p>
<p><br></p>
<p>The <em>spixel_segmentation()</em> takes as method parameter the <em>Mini-Batch-Kmeans</em> too, which can decrease the computation time at the cost of a reduced image quality. However, the advantage of using <em>Superpixels + AP + Kmeans (or Mini-Batch-Kmeans)</em> <em>lies in the fact that the user does not have to specify the number of clusters beforehand</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a></span>
<span id="cb11-2"><a href="#cb11-2"></a>spx_mbkm =<span class="st"> </span>init<span class="op">$</span><span class="kw">spixel_segmentation</span>(<span class="dt">input_image =</span> im_km, </span>
<span id="cb11-3"><a href="#cb11-3"></a>                                    <span class="dt">superpixel =</span> <span class="dv">600</span>, </span>
<span id="cb11-4"><a href="#cb11-4"></a>                                    <span class="dt">AP_data =</span> <span class="ot">TRUE</span>,</span>
<span id="cb11-5"><a href="#cb11-5"></a>                                    <span class="dt">use_median =</span> <span class="ot">TRUE</span>, </span>
<span id="cb11-6"><a href="#cb11-6"></a>                                    <span class="dt">sim_wL =</span> <span class="dv">3</span>, </span>
<span id="cb11-7"><a href="#cb11-7"></a>                                    <span class="dt">sim_wA =</span> <span class="dv">10</span>, </span>
<span id="cb11-8"><a href="#cb11-8"></a>                                    <span class="dt">sim_wB =</span> <span class="dv">10</span>,</span>
<span id="cb11-9"><a href="#cb11-9"></a>                                    <span class="dt">sim_color_radius =</span> <span class="dv">10</span>, </span>
<span id="cb11-10"><a href="#cb11-10"></a>                                    <span class="dt">kmeans_method =</span> <span class="st">"mini_batch_kmeans"</span>,</span>
<span id="cb11-11"><a href="#cb11-11"></a>                                    <span class="dt">kmeans_initializer =</span> <span class="st">"kmeans++"</span>,</span>
<span id="cb11-12"><a href="#cb11-12"></a>                                    <span class="dt">kmeans_num_init =</span> <span class="dv">3</span>, </span>
<span id="cb11-13"><a href="#cb11-13"></a>                                    <span class="dt">kmeans_max_iters =</span> <span class="dv">100</span>,</span>
<span id="cb11-14"><a href="#cb11-14"></a>                                    <span class="dt">minib_kmeans_batch =</span> <span class="dv">10</span>, </span>
<span id="cb11-15"><a href="#cb11-15"></a>                                    <span class="dt">minib_kmeans_init_fraction =</span> <span class="fl">0.75</span>,</span>
<span id="cb11-16"><a href="#cb11-16"></a>                                    <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb11-17"><a href="#cb11-17"></a>                                    </span>
<span id="cb11-18"><a href="#cb11-18"></a></span>
<span id="cb11-19"><a href="#cb11-19"></a>Sequential computation starts ...</span>
<span id="cb11-20"><a href="#cb11-20"></a>WARNING<span class="op">:</span><span class="st"> </span>The input data has values between <span class="fl">0.000000</span> and <span class="dv">1</span>.<span class="fl">000000.</span> The image<span class="op">-</span>data will be multiplied by the value<span class="op">:</span><span class="st"> </span><span class="dv">255</span><span class="op">!</span></span>
<span id="cb11-21"><a href="#cb11-21"></a>The super<span class="op">-</span>pixel slic method as pre<span class="op">-</span>processing step was used <span class="op">/</span><span class="st"> </span>completed<span class="op">!</span></span>
<span id="cb11-22"><a href="#cb11-22"></a>The similarity matrix based on super<span class="op">-</span>pixels was computed<span class="op">!</span></span>
<span id="cb11-23"><a href="#cb11-23"></a>It took <span class="dv">146</span> iterations <span class="cf">for</span> affinity propagation to complete<span class="op">!</span></span>
<span id="cb11-24"><a href="#cb11-24"></a><span class="dv">10</span> clusters were chosen based on super<span class="op">-</span>pixels and affinity propagation<span class="op">!</span></span>
<span id="cb11-25"><a href="#cb11-25"></a>Image data based on Affinity Propagation <span class="kw">clustering</span> (<span class="st">'AP_image_data'</span>) will be returned<span class="op">!</span></span>
<span id="cb11-26"><a href="#cb11-26"></a>The mini<span class="op">-</span>batch<span class="op">-</span>kmeans algorithm based on the number of affinity<span class="op">-</span>propagation<span class="op">-</span>clusters was completed<span class="op">!</span></span>
<span id="cb11-27"><a href="#cb11-27"></a>Pre<span class="op">-</span>processing of the mini<span class="op">-</span>batch<span class="op">-</span>kmeans<span class="op">-</span>output<span class="op">-</span>image is completed<span class="op">!</span></span>
<span id="cb11-28"><a href="#cb11-28"></a>Elapsed time<span class="op">:</span><span class="st"> </span><span class="dv">0</span> hours and <span class="dv">0</span> minutes and <span class="dv">3</span> seconds. </span>
<span id="cb11-29"><a href="#cb11-29"></a></span></code></pre></div>
<p><br></p>
<p>The following image is based on <em>Superpixels + AP + Mini-Batch-Kmeans</em>,</p>
<p><br></p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="fu">OpenImageR</span><span class="fu">::</span><span class="fu"><a href="../reference/imageShow.html">imageShow</a></span><span class="op">(</span><span class="va">spx_mbkm</span><span class="op">$</span><span class="va">KMeans_image_data</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/segment_mbkm.png"></p>
<p><br></p>
<p>Further parameters which can be adjusted in the <em>spixel_segmentation()</em> method are:</p>
<ul>
<li>
<em>method</em> (“slic”, “slico”)</li>
<li>
<em>colour_type</em> (“RGB”, “LAB” or “HSV”)</li>
</ul>
<p>More details can be found in the <a href="https://github.com/mlampros/SuperpixelImageSegmentation" class="external-link">SuperpixelImageSegmentation</a> R package documentation.</p>
<p><br></p>
</div>
<div class="section level3">
<h3 id="image-masks">Image Masks<a class="anchor" aria-label="anchor" href="#image-masks"></a>
</h3>
<p>The <em>spixel_masks_show()</em> method in combination with the <em>adjust_centroids_and_return_masks</em> parameter (set to TRUE), allows users to also plot the masks belonging to each separate cluster,</p>
<p><br></p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a></span>
<span id="cb13-2"><a href="#cb13-2"></a>spx_masks =<span class="st"> </span>init<span class="op">$</span><span class="kw">spixel_segmentation</span>(<span class="dt">input_image =</span> im_km, </span>
<span id="cb13-3"><a href="#cb13-3"></a>                                     <span class="dt">superpixel =</span> <span class="dv">600</span>, </span>
<span id="cb13-4"><a href="#cb13-4"></a>                                     <span class="dt">AP_data =</span> <span class="ot">TRUE</span>,</span>
<span id="cb13-5"><a href="#cb13-5"></a>                                     <span class="dt">use_median =</span> <span class="ot">TRUE</span>, </span>
<span id="cb13-6"><a href="#cb13-6"></a>                                     <span class="dt">sim_wL =</span> <span class="dv">3</span>, </span>
<span id="cb13-7"><a href="#cb13-7"></a>                                     <span class="dt">sim_wA =</span> <span class="dv">10</span>, </span>
<span id="cb13-8"><a href="#cb13-8"></a>                                     <span class="dt">sim_wB =</span> <span class="dv">10</span>,</span>
<span id="cb13-9"><a href="#cb13-9"></a>                                     <span class="dt">sim_color_radius =</span> <span class="dv">10</span>, </span>
<span id="cb13-10"><a href="#cb13-10"></a>                                     <span class="dt">kmeans_method =</span> <span class="st">"kmeans"</span>,</span>
<span id="cb13-11"><a href="#cb13-11"></a>                                     <span class="dt">kmeans_initializer =</span> <span class="st">"kmeans++"</span>,</span>
<span id="cb13-12"><a href="#cb13-12"></a>                                     <span class="dt">adjust_centroids_and_return_masks =</span> <span class="ot">TRUE</span>,</span>
<span id="cb13-13"><a href="#cb13-13"></a>                                     <span class="dt">verbose =</span> <span class="ot">TRUE</span>)</span>
<span id="cb13-14"><a href="#cb13-14"></a></span>
<span id="cb13-15"><a href="#cb13-15"></a></span>
<span id="cb13-16"><a href="#cb13-16"></a>Sequential computation starts ...</span>
<span id="cb13-17"><a href="#cb13-17"></a>WARNING<span class="op">:</span><span class="st"> </span>The input data has values between <span class="fl">0.000000</span> and <span class="dv">1</span>.<span class="fl">000000.</span> The image<span class="op">-</span>data will be multiplied by the value<span class="op">:</span><span class="st"> </span><span class="dv">255</span><span class="op">!</span></span>
<span id="cb13-18"><a href="#cb13-18"></a>The super<span class="op">-</span>pixel slic method as pre<span class="op">-</span>processing step was used <span class="op">/</span><span class="st"> </span>completed<span class="op">!</span></span>
<span id="cb13-19"><a href="#cb13-19"></a>The similarity matrix based on super<span class="op">-</span>pixels was computed<span class="op">!</span></span>
<span id="cb13-20"><a href="#cb13-20"></a>It took <span class="dv">146</span> iterations <span class="cf">for</span> affinity propagation to complete<span class="op">!</span></span>
<span id="cb13-21"><a href="#cb13-21"></a><span class="dv">10</span> clusters were chosen based on super<span class="op">-</span>pixels and affinity propagation<span class="op">!</span></span>
<span id="cb13-22"><a href="#cb13-22"></a>Image data based on Affinity Propagation <span class="kw">clustering</span> (<span class="st">'AP_image_data'</span>) will be returned<span class="op">!</span></span>
<span id="cb13-23"><a href="#cb13-23"></a>The kmeans algorithm based on the number of affinity<span class="op">-</span>propagation<span class="op">-</span>clusters was completed<span class="op">!</span></span>
<span id="cb13-24"><a href="#cb13-24"></a>NOTE<span class="op">:</span><span class="st"> </span>The <span class="st">'KMeans_image_data'</span> will be returned <span class="cf">in</span> black <span class="op">&amp;</span><span class="st"> </span>white colour due to the fact that the <span class="st">'adjust_centroids_and_return_masks'</span> parameter was set to <span class="ot">TRUE</span><span class="op">!</span></span>
<span id="cb13-25"><a href="#cb13-25"></a>Pre<span class="op">-</span>processing of the kmeans<span class="op">-</span>output<span class="op">-</span>image is completed<span class="op">!</span></span>
<span id="cb13-26"><a href="#cb13-26"></a>The centroids were adjusted and the image<span class="op">-</span>masks will be returned<span class="op">!</span></span>
<span id="cb13-27"><a href="#cb13-27"></a>Elapsed time<span class="op">:</span><span class="st"> </span><span class="dv">0</span> hours and <span class="dv">0</span> minutes and <span class="dv">8</span> seconds. </span>
<span id="cb13-28"><a href="#cb13-28"></a></span>
<span id="cb13-29"><a href="#cb13-29"></a></span>
<span id="cb13-30"><a href="#cb13-30"></a><span class="kw">str</span>(spx_masks)</span>
<span id="cb13-31"><a href="#cb13-31"></a></span>
<span id="cb13-32"><a href="#cb13-32"></a>List of <span class="dv">4</span></span>
<span id="cb13-33"><a href="#cb13-33"></a> <span class="op">$</span><span class="st"> </span>KMeans_image_data<span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">5</span> <span class="dv">5</span> <span class="dv">4</span> <span class="dv">7</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">7</span> <span class="dv">7</span> ...</span>
<span id="cb13-34"><a href="#cb13-34"></a> <span class="op">$</span><span class="st"> </span>masks            <span class="op">:</span>List of <span class="dv">10</span></span>
<span id="cb13-35"><a href="#cb13-35"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="fl">0.404</span> ...</span>
<span id="cb13-36"><a href="#cb13-36"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-37"><a href="#cb13-37"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-38"><a href="#cb13-38"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-39"><a href="#cb13-39"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="fl">0.294</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-40"><a href="#cb13-40"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="fl">0.0784</span> <span class="fl">0.1216</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-41"><a href="#cb13-41"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-42"><a href="#cb13-42"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="fl">0.392</span> <span class="dv">0</span> ...</span>
<span id="cb13-43"><a href="#cb13-43"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-44"><a href="#cb13-44"></a>  ..<span class="op">$</span><span class="st"> </span><span class="er">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> <span class="dv">0</span> ...</span>
<span id="cb13-45"><a href="#cb13-45"></a>  ..<span class="op">-</span><span class="st"> </span><span class="kw">attr</span>(<span class="op">*</span>, <span class="st">"dim"</span>)=<span class="st"> </span>int [<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>] <span class="dv">10</span> <span class="dv">1</span></span>
<span id="cb13-46"><a href="#cb13-46"></a> <span class="op">$</span><span class="st"> </span>centr            <span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="dv">0</span> <span class="dv">1</span> <span class="dv">2</span> <span class="dv">3</span> <span class="dv">4</span> <span class="dv">5</span> <span class="dv">6</span> <span class="dv">7</span> <span class="dv">8</span> <span class="dv">9</span> ...</span>
<span id="cb13-47"><a href="#cb13-47"></a> <span class="op">$</span><span class="st"> </span>AP_image_data    <span class="op">:</span><span class="st"> </span>num [<span class="dv">1</span><span class="op">:</span><span class="dv">321</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">481</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">3</span>] <span class="fl">0.404</span> <span class="fl">0.404</span> <span class="fl">0.404</span> <span class="fl">0.404</span> <span class="fl">0.404</span> ...</span></code></pre></div>
<p><br></p>
<p>the <em>display_all</em> parameter enables plotting of masks either all at once or sequentially,</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">init</span><span class="op">$</span><span class="fu">spixel_masks_show</span><span class="op">(</span>display_all <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><br></p>
<p><img src="vignette_3/im_masks.png"></p>
<p><br><br></p>
<p><strong>References :</strong></p>
<ul>
<li><a href="https://www.ijsr.net/archive/v4i4/SUB152869.pdf" class="external-link">Image Segmentation using SLIC Superpixels and Affinity Propagation Clustering, Bao Zhou, 2013</a></li>
<li><a href="https://en.wikipedia.org/wiki/Image_segmentation" class="external-link">Image segmentation, wikipedia</a></li>
<li><a href="https://www.epfl.ch/labs/ivrl/research/slic-superpixels/" class="external-link">SLIC Superpixels</a></li>
<li><a href="https://arxiv.org/pdf/1612.01601.pdf" class="external-link">Superpixels: An Evaluation of the State-of-the-Art, David Stutz, Alexander Hermans, Bastian Leibe, 2016</a></li>
<li>
<strong>Affinity Propagation</strong> ( www.psi.toronto.edu/index.php?q=affinity%20propagation )</li>
<li>
<strong>Clustering by Passing Messages Between Data Points, Brendan J. Frey and Delbert Dueck, University of Toronto, Science 315, 972-976, February 2007</strong> ( www.psi.toronto.edu/affinitypropagation/FreyDueckScience07.pdf )</li>
<li><a href="https://en.wikipedia.org/wiki/CIELAB_color_space" class="external-link">CIELAB colour space</a></li>
<li><a href="https://www2.eecs.berkeley.edu/Research/Projects/CS/vision/grouping/resources.html" class="external-link">Berkeley Segmentation Database (BSD)</a></li>
<li><a href="https://github.com/mlampros/OpenImageR" class="external-link">OpenImageR package</a></li>
<li><a href="https://github.com/mlampros/ClusterR" class="external-link">ClusterR package</a></li>
<li><a href="https://github.com/mlampros/SuperpixelImageSegmentation" class="external-link">SuperpixelImageSegmentation package</a></li>
</ul>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Lampros Mouselimis.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.6.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
